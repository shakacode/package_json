#!/usr/bin/env bash
# Lint Ruby files with RuboCop
set -euo pipefail

if [ $# -eq 0 ]; then
  echo "âœ… No Ruby files to lint"
  exit 0
fi

# Filter out non-existent files (e.g., deleted files)
existing_files=()
for file in "$@"; do
  if [ -f "$file" ]; then
    existing_files+=("$file")
  fi
done

if [ ${#existing_files[@]} -eq 0 ]; then
  echo "âœ… No existing Ruby files to lint"
  exit 0
fi

echo "ğŸ” RuboCop on staged Ruby files:"
printf "  %s\n" "${existing_files[@]}"

if ! bundle exec rubocop --force-exclusion --display-cop-names -- "${existing_files[@]}"; then
  echo ""
  echo "âŒ RuboCop check failed!"
  echo "ğŸ’¡ Auto-fix: bundle exec rubocop -a --force-exclusion -- <files>"
  echo "ğŸš« Skip hook: git commit --no-verify"
  exit 1
fi

echo "âœ… RuboCop checks passed"
